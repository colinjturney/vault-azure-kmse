# Vault Azure Key Management Secrets Engine Demo
A demo implementation of Vault's Key Management Secrets Engine, integrating with Azure Key Vault. Utilises features introduced in Vault 1.6.0

Additionally gives an example use case of how a key generated by HashiCorp Vault can be used to encrypt a disk volume for an Azure VM.

## Pre-Requisites
* An Azure account
* Terraform (tested with v0.13.2)

It may be possible to implement the demo with other versions of the above software, but this is neither tested
or guaranteed.

## Steps

1. Ensure you've logged in to Azure using Azure CLI.
1. cd to terraform/control-1
1. Optionally replace the values in `terraform.tfvars` to suit your own use case (e.g. creator name, network address prefixes, etc)
1. Run `terraform init`
1. Optionally run `terraform plan` to review the resources that will be created.
1. Run `terraform apply` to apply the changes.
1. Once the Terraform run is complete, you will find a file called `vault-ssh.pem` in the control directory. Use this, combined with the outputted public_ip_address to ssh onto the Vault VM. e.g. `ssh -i vault-ssh.pem azureuser@
1. Run the numbered scripts in the `/home/azureuser` directory in numerical order to first initialise and unseal Vault, and then configure the Key Management Secrets Engine, before exporting the created keys into Azure Key Vault.
1. Before moving to the next step, make a note of the Key Identifier URL for the rsa-1 key that was created in the Azure Key Vault by HashiCorp Vault's Key Management Secrets Engine.
1. cd to terraform/control-2
1. Run `terraform init`
1. Optionally run `terraform plan` and then run `terraform apply` to apply the changes. You will be prompted to input the Key Identifier URL (`var.example_kvk_id`).
1. Terraform will then create a VM with a disk encrypted using the key supplied to Azure Key Vault by HashiCorp Vault.

## Warning
This demo is provided as-is with no support or guarantee. It makes no claim as to "production-readiness" in areas including but not limited to:
- Configuration of Vault (including unsealing and configure Vault)
- Configuration of Azure
